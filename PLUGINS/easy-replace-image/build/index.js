const exposeERIerror = (error) =>{const elem = document.querySelector('.js-serifu-image-processed-response');if (elem){elem.classList.add('error');elem.innerHTML = error;}};const getERIid = () =>{return document.getElementById('eri-item-id').value.replace('wrap-','');};const getERIrand = () =>{return new Date().getTime() / 1000 + '' + Math.floor(Math.random() * 100);};const getERISrcRand = (str) =>{let s = str;s += str.includes('?') ? '&':'?';s += 'time=' + getERIrand();return s;};const processERIresponse = (data,elem,type) =>{const responseWrap = document.querySelector('.js-serifu-image-processed-response');if (responseWrap){responseWrap.classList.remove('error');responseWrap.innerHTML = '';}if (data !== null && data.url !== ''){const imgs = document.querySelectorAll('#set-post-thumbnail img,.editor-post-featured-image img');if (imgs){imgs.forEach((img) =>{img.setAttribute('src',data.url);img.setAttribute('srcset',data.srcset);});}const contentImages = document.querySelectorAll('figure img,.wp_attachment_image img.thumbnail');if (contentImages){contentImages.forEach((img) =>{const s = img.getAttribute('src');img.setAttribute('src',getERISrcRand(s));});}const thmbs = document.querySelectorAll('#thumbnail-head-' + getERIid() + ' .thumbnail,#eri-search-result-' + getERIid() + ' img');if (thmbs){thmbs.forEach((img) =>{img.setAttribute('src',data.url);img.removeAttribute('srcset');});}const extra = document.querySelector('#media-extra-info-' + getERIid());if (extra){extra.innerHTML = data.extra_info;}}else if ('url' === type){exposeERIerror(eriSettings.failedFetch);}else{exposeERIerror(eriSettings.failedUpload);}};function startERIupload(){const eriWrap = document.getElementById('eri-feature-wrapper');const fileInput = document.querySelector('.js-serifu-image-upload');if (fileInput){if (! fileInput.value){exposeERIerror(eriSettings.emptyFile);}else{var args = new FormData();args.append('action','eri_from_upload');args.append('old_image_id',getERIid());args.append('file',fileInput.files[ 0 ]);args.append('security',eriSettings.nonce);if (eriWrap){eriWrap.classList.add('processing');}eriActionProcessing();fetch(eriSettings.ajaxUrl,{method:'POST',mode:'cors',cache:'no-cache',credentials:'same-origin',body:args,}).then((response) =>{return response.text();}).then((data) =>{fileInput.value = '';if (eriWrap){eriWrap.classList.remove('processing');}processERIresponse(JSON.parse(data),eriWrap,'upload');}).catch(() =>{if (eriWrap){eriWrap.classList.remove('processing');}});}}}function startERIdownload(){const eriWrap = document.getElementById('eri-feature-wrapper');const fileInput = document.querySelector('.js-serifu-image-fetch');if (fileInput){if (! fileInput.value){exposeERIerror(eriSettings.emptyUrl);}else{var args = new FormData();args.append('action','eri_from_url');args.append('old_image_id',getERIid());args.append('file',fileInput.value);args.append('security',eriSettings.nonce);if (eriWrap){eriWrap.classList.add('processing');}eriActionProcessing();fetch(eriSettings.ajaxUrl,{method:'POST',mode:'cors',cache:'no-cache',credentials:'same-origin',body:args,}).then((response) =>{return response.text();}).then((data) =>{fileInput.value = '';if (eriWrap){eriWrap.classList.remove('processing');}processERIresponse(JSON.parse(data),eriWrap,'url');}).catch(() =>{if (eriWrap){eriWrap.classList.remove('processing');}});}}}const updateERIContent = (item) =>{if (item){const id = item.getAttribute('imageid');let content = eriSettings.elementAction;content = content.replaceAll('wrap-0','wrap-' + id);content = content.replaceAll('upload-file-0','upload-file-' + id);content = content.replaceAll('attachment-id="0"','attachment-id="' + id + '"');item.innerHTML = content;}};const bindERIEvents = (item) =>{if (item){const eriWrap = document.getElementById('eri-feature-wrapper');const wrap = item.querySelector('.js-serifu-image-fetch-wrap');if (wrap){const opt = wrap.querySelectorAll('[name="serifu_replace_type"]');if (opt){[].forEach.call(opt,(radioItem) =>{radioItem.addEventListener('change',() =>{if ('url' === radioItem.value){document.getElementById('js-eri-type-url').classList.remove('is-hidden');document.getElementById('js-eri-type-upload').classList.add('is-hidden');eriWrap.classList.remove('is-upload');eriWrap.classList.add('is-download');}else{document.getElementById('js-eri-type-url').classList.add('is-hidden');document.getElementById('js-eri-type-upload').classList.remove('is-hidden');eriWrap.classList.remove('is-download');eriWrap.classList.add('is-upload');}});});}}}};const triggerERIchanged = () =>{const eriWrap = document.getElementById('eri-feature-wrapper');if (eriWrap){updateERIContent(eriWrap);bindERIEvents(eriWrap);}};const initMonitorChanges = (item) =>{let observer = new MutationObserver(function (mutations){mutations.forEach(function (mutation){if (mutation.type === 'attributes'){triggerERIchanged();}});});observer.observe(item,{attributes:true,});};const initERIMonitors = () =>{document.addEventListener('readystatechange',(event) =>{/* event.target.readyState === 'interactive' */if (event.target.readyState === 'complete'){const eriWrap = document.getElementById('eri-feature-wrapper');if (eriWrap){if (! eriWrap.classList.contains('in-attachment-view')){triggerERIchanged();}else{bindERIEvents(eriWrap);}}}});};function eriResetImageItem(){const item = document.getElementById('eri-paged');if (item){item.value = 1;}const id = document.getElementById('eri-id');if (id){id.value = 0;}}function eriSelectImageItem(id){if (id){eriSettingsProcessing();const frm = document.getElementById('eri-frm-search');if (frm){const item = document.getElementById('eri-id');if (item){item.value = id;}frm.submit();}}}const eriSettingsProcessing = () =>{const wrap = document.getElementById('eri-settings1');if (wrap){wrap.classList.add('processing');}};const eriActionProcessing = () =>{const wrap = document.getElementById('eri-feature-wrapper');if (wrap){wrap.classList.add('processing');}};const initERISettings = () =>{const targets = document.querySelectorAll('#eri-settings1 button,#eri-settings1 .pagination .page-numbers');if (targets){[].forEach.call(targets,(item) =>{item.addEventListener('click',() =>{eriSettingsProcessing();});});}};initERIMonitors();initERISettings();